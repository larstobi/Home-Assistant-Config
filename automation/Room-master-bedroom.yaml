- id: '40'    
  alias: 'Master bedroom morning'
  trigger:
    - platform: state
      entity_id: input_select.time_of_day
      to: 'Morning'
    - platform: state
      entity_id: input_select.home_state
      to: 'Home'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.home_state
        state: 'Home'
      - condition: state
        entity_id: input_select.time_of_day
        state: 'Morning'
      - condition: state
        entity_id: input_boolean.sleep_state_tor
        state: 'off'
      - condition: state
        entity_id: input_boolean.sleep_state_lande
        state: 'off'
  action:
    - service: light.turn_on
      entity_id: light.bedside_lamp_dimmer_level
      data:
        brightness: 150
    - service: light.turn_on
      entity_id: light.bedroom_tv_backlight_level
      data:
        brightness: 255
        rgb_color: [211,221,247]
    - service: switch.turn_on
      entity_id: switch.dressing_table_light_switch
    - service: switch.turn_on
      entity_id: switch.dressing_room_wardrobes_switch
    - service: light.turn_on
      entity_id: light.changing_room_ceiling_light_level

- id: '41'    
  alias: 'Master bedroom day'
  trigger:
    - platform: state
      entity_id: input_select.time_of_day
      to: 'Day'
    - platform: state
      entity_id: input_select.home_state
      to: 'Home'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.home_state
        state: 'Home'
      - condition: state
        entity_id: input_select.time_of_day
        state: 'Day'
      - condition: state
        entity_id: input_boolean.sleep_state_tor
        state: 'off'
      - condition: state
        entity_id: input_boolean.sleep_state_lande
        state: 'off'
  action:
    - service: light.turn_off
      entity_id: light.bedside_lamp_dimmer_level
    - service: light.turn_off
      entity_id: light.bedroom_tv_backlight_level
    - service: switch.turn_off
      entity_id: switch.dressing_table_light_switch
    - service: switch.turn_on
      entity_id: switch.dressing_room_wardrobes_switch

- id: '42'    
  alias: 'Master bedroom evening'
  trigger:
    - platform: state
      entity_id: input_select.time_of_day
      to: 'Evening'
    - platform: state
      entity_id: input_select.home_state
      to: 'Home'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.home_state
        state: 'Home'
      - condition: state
        entity_id: input_select.time_of_day
        state: 'Evening'
      - condition: state
        entity_id: input_boolean.sleep_state_tor
        state: 'off'
      - condition: state
        entity_id: input_boolean.sleep_state_lande
        state: 'off'
  action:
    - service: light.turn_on
      entity_id: light.bedside_lamp_dimmer_level
      data:
        brightness: 150
    - service: light.turn_on
      entity_id: light.bedroom_tv_backlight_level
      data:
        brightness: 255
        rgb_color: [255,165,0]
    - service: switch.turn_on
      entity_id: switch.dressing_table_light_switch
    - service: switch.turn_on
      entity_id: switch.dressing_room_wardrobes_switch

- id: '43'    
  alias: 'Master bedroom off'
  trigger:
    - platform: state
      entity_id: input_select.time_of_day
      to: 'Night'
    - platform: state
      entity_id: input_select.home_state
      to: 'Away'
    - platform: state
      entity_id: input_boolean.sleep_state_tor, input_boolean.sleep_state_lande
      to: 'on'
  action:
    - service: light.turn_off
      entity_id: light.bedside_lamp_dimmer_level
    - service: light.turn_off
      entity_id: light.bedroom_tv_backlight_level
    - service: switch.turn_off
      entity_id: switch.dressing_table_light_switch
    - service: switch.turn_off
      entity_id: switch.dressing_room_wardrobes_switch
    - service: light.turn_off
      entity_id: light.changing_room_ceiling_light_level

- id: '69'    
  alias: 'Dressing room ceiling light on'
  trigger:
    - platform: state
      entity_id: binary_sensor.dressingroom_motion_sensor_sensor
      to: 'on'
  condition:
    condition: template
    value_template: "{{not is_state('input_select.time_of_day', 'Night')}}"
  action:
    - service: light.turn_on
      entity_id: light.changing_room_ceiling_light_level

- id: '70'    
  alias: 'Dressing room ceiling light off'
  trigger:
    - platform: state
      entity_id: binary_sensor.dressingroom_motion_sensor_sensor
      to: 'off'
  condition:
    condition: template
    value_template: "{{not is_state('input_select.time_of_day', 'Night')}}"
  action:
    - service: light.turn_off
      entity_id: light.changing_room_ceiling_light_level

- id: '80'    
  alias: 'Dressing room ceiling light on night'
  trigger:
    - platform: state
      entity_id: binary_sensor.dressingroom_motion_sensor_sensor
      to: 'on'
  condition:
    condition: state
    entity_id: input_select.time_of_day
    state: 'Night'
  action:
    - service: switch.turn_on
      entity_id: switch.dressing_room_wardrobes_switch

- id: '81'    
  alias: 'Dressing room ceiling light off night'
  trigger:
    - platform: state
      entity_id: binary_sensor.dressingroom_motion_sensor_sensor
      to: 'off'
  condition:
    condition: state
    entity_id: input_select.time_of_day
    state: 'Night'
  action:
    - service: switch.turn_off
      entity_id: switch.dressing_room_wardrobes_switch

- id: '35'
  alias: 'Pre-wakeup alarm tmc'
  trigger:
    platform: state
    entity_id: sensor.time
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.home_state
        state: 'Home'
      - condition: state
        entity_id: input_boolean.sleep_state_tor
        state: 'on'
      - condition: template
        value_template: '{{(now().strftime("%s") | int +900) | timestamp_custom("%H:%M")  == "%0.02d:%0.02d" | format(states.input_datetime.alarm_time_tor.attributes.hour | int, states.input_datetime.alarm_time_tor.attributes.minute | int)}}'
      - condition: template
        value_template: '{{(is_state("input_boolean.alarm_workday_tor", "on") and is_state("binary_sensor.workday_sensor", "on")) or is_state("input_boolean.alarm_workday_tor","off")}}'
      - condition: state
        entity_id: input_boolean.alarm_override_tor
        state: 'off'
  action:
    - service: python_script.transition_light
      data:
        entity_id: light.bedside_lamp_dimmer_level
        transition: 1800
        brightness: 255

- id: '83'
  alias: 'Wakeup alarm tmc'
  trigger:
    platform: state
    entity_id: sensor.time
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.home_state
        state: 'Home'
      - condition: state
        entity_id: input_boolean.sleep_state_tor
        state: 'on'
      - condition: template
        value_template: '{{states.sensor.time.state == "%0.02d:%0.02d" | format(states.input_datetime.alarm_time_tor.attributes.hour | int, states.input_datetime.alarm_time_tor.attributes.minute | int)}}'
      - condition: template
        value_template: '{{(is_state("input_boolean.alarm_workday_tor", "on") and is_state("binary_sensor.workday_sensor", "on")) or is_state("input_boolean.alarm_workday_tor","off")}}'
      - condition: state
        entity_id: input_boolean.alarm_override_tor
        state: 'off'
  action:
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.sleep_state_tor

- id: '84'
  alias: 'Wakeup alarm lande'
  trigger:
    platform: state
    entity_id: sensor.time
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.home_state
        state: 'Home'
      - condition: state
        entity_id: input_boolean.sleep_state_lande
        state: 'on'
      - condition: template
        value_template: '{{states.sensor.time.state == "%0.02d:%0.02d" | format(states.input_datetime.alarm_time_lande.attributes.hour | int, states.input_datetime.alarm_time_lande.attributes.minute | int)}}'
      - condition: template
        value_template: '{{(is_state("input_boolean.alarm_workday_lande", "on") and is_state("binary_sensor.workday_sensor", "on")) or is_state("input_boolean.alarm_workday_lande","off")}}'
      - condition: state
        entity_id: input_boolean.alarm_override_lande
        state: 'off'
  action:
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.sleep_state_lande

- id: '12'
  alias: 'Wakeup alarm 2'
  trigger:
    platform: state
    entity_id: input_boolean.sleep_state_tor, input_boolean.sleep_state_lande
    to: 'off'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
      - condition: state
        entity_id: input_select.home_state
        state: 'Home'
      - condition: state
        entity_id: input_boolean.sleep_state_tor
        state: 'off'
      - condition: state
        entity_id: input_boolean.sleep_state_tor
        state: 'off'
  action:
    - service: media_player.volume_set
      data:
        entity_id: media_player.changing_room
        volume_level: 0.35
    - service: media_player.select_source
      data:
        entity_id: media_player.changing_room
        source: 'BBC World Service News'
