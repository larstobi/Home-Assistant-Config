###
# Control Time of Day
###
- id: '7'
  alias: 'Set Time of Day to Morning'
  trigger:
    - platform: state
      entity_id: input_boolean.sleep_state_tor, input_boolean.sleep_state_lande, input_boolean.sleep_state_ingrid, input_boolean.sleep_state_guests
      to: 'off'
    - platform: time
      at: '08:45:00'   
  condition:
    condition: state
    entity_id: input_select.time_of_day
    state: 'Night'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.time_of_day
        option: Morning
    - service: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.home_alarm
      data:
        code: !secret alarm_control_panel_code

- id: '8'
  alias: 'Set Time of Day to Day'
  trigger:
    - platform: sun
      event: sunrise
    - platform: time
      at: '09:00:00'   
  condition:
    condition: state
    entity_id: input_select.time_of_day
    state: 'Morning'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.time_of_day
        option: Day

- id: '9'
  alias: 'Set Time of Day to Evening'
  trigger:
    - platform: time
      at: '20:00:00'
  condition:
    condition: state
    entity_id: input_select.time_of_day
    state: 'Day'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.time_of_day
        option: Evening

- id: '10'
  alias: 'Set Time of Day to Night'
  trigger:
    platform: state
    entity_id: input_boolean.sleep_state_tor, input_boolean.sleep_state_lande, input_boolean.sleep_state_ingrid, input_boolean.sleep_state_guests
    to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.time_of_day
        state: 'Evening'
      - condition: or
        conditions:
          - condition: template
            value_template: '{{ not is_state("input_select.home_state", "Home") }}'
          - condition: and
            conditions:
              - condition: state
                entity_id: input_boolean.sleep_state_tor
                state: 'on'
              - condition: state
                entity_id: input_boolean.sleep_state_lande
                state: 'on'
              - condition: state
                entity_id: input_boolean.sleep_state_ingrid
                state: 'on'
              - condition: template
                value_template: '{{(is_state("input_boolean.guests_present", "on") and is_state("input_boolean.sleep_state_guests", "on")) or is_state("input_boolean.guests_present","off")}}'
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.time_of_day
        option: Night
    - service: alarm_control_panel.alarm_arm_home
      entity_id: alarm_control_panel.home_alarm
      data:
        code: !secret alarm_control_panel_code
